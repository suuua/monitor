!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Monitor=t()}(this,function(){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t){if(!e||!e.length)return!1;for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function o(e){return"function"==typeof e}var s=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this,e),"object"===u(t)?(this.lineno=t.lineNumber||t.lineno,this.colno=t.columnNumber||t.colno,this.message=t.message,this.fileName=t.fileName||t.filename,this.stack=t.stack||t.error&&t.error.stack):"string"==typeof t&&(this.message=t)};function h(e,t){return function n(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!i||!o)return i===o;var e=Object.keys(i),t=Object.keys(o);return e.length===t.length&&e.every(function(e){var t=i[e],r=o[e];return"object"===u(t)&&"object"===u(r)?n(t,r):String(t)===String(r)})}(e,t)}var v=function(){function r(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).submit,t=void 0===e?function(){}:e;a(this,r),this.submit=t}return t(r,[{key:"addReport",value:function(e,t){return this}}]),r}(),_=function(){function r(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).timeLimit,t=void 0===e?1e4:e;a(this,r),this.timeLimit=t,this.__queue=[]}return t(r,[{key:"isDuplicate",value:function(e){if(!e)return!1;var t=new s(e),r=-1;function n(e){r<0&&(r=e)}for(var i=-1,o=0;o<this.__queue.length;o++){var u=this.__queue[o];if(u){if(this.__isTimeout(u))this.__queue[o]=null,n(o);else if(h(u.eei,e)){u.t=+new Date,i=o;break}}else n(o)}return i<0&&(-1<r?this.__queue[r]={eei:t,t:+new Date}:this.__queue.push({eei:t,t:+new Date})),-1<i}},{key:"__isTimeout",value:function(e){return new Date-e.t>this.timeLimit}}]),r}(),p=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.reporter,r=e.beforeReport;a(this,n),this.reporter=t,this.beforeReport=r,this.__duplicate=new _}return t(n,[{key:"__report",value:function(e){var t=function(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},t=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),t.forEach(function(e){var t,r,n;t=i,n=o[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n})}return i}({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{from:this});if(this.reporter&&!this.__duplicate.isDuplicate(e))try{this.beforeReport&&this.beforeReport(e,t),"function"==typeof this.reporter?this.reporter(e,t):this.reporter instanceof v&&this.reporter.addReport(e,t)}catch(e){}}},{key:"createExtractInfo",value:function(e){return new s(e)}}]),n}(),m=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=f(this,l(r).call(this,t))).level=t.level||0,e}return i(r,p),t(r,[{key:"log",value:function(e){var t=r.LEVEL_LOG;this.level<=t&&this.__report(this.createExtractInfo(e),{level:t})}},{key:"info",value:function(e){var t=r.LEVEL_INFO;this.level<=t&&this.__report(this.createExtractInfo(e),{level:t})}},{key:"warn",value:function(e){var t=r.LEVEL_WARN;this.level<=t&&this.__report(this.createExtractInfo(e),{level:t})}},{key:"error",value:function(e){var t=r.LEVEL_ERROR;this.level<=t&&this.__report(this.createExtractInfo(e),{level:t})}}],[{key:"LEVEL_LOG",get:function(){return 1}},{key:"LEVEL_INFO",get:function(){return 2}},{key:"LEVEL_WARN",get:function(){return 3}},{key:"LEVEL_ERROR",get:function(){return 4}}]),r}(),y=window,d=function(e){function r(e){var t;return a(this,r),(t=f(this,l(r).call(this,e))).__addHandler(),t}return i(r,p),t(r,[{key:"__addHandler",value:function(){var e=this,t=function(){e.__report(e.createExtractInfo({message:JSON.stringify({timing:y.performance.timing,effectiveType:y.navigator.connection&&y.navigator.connection.effectiveType,rtt:y.navigator.connection&&y.navigator.connection.rtt})}))};"complete"===document.readyState?t():y.addEventListener("load",t)}}]),r}(),b=window,g=function(e){function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return a(this,r),(e=f(this,l(r).call(this,t))).collect=t.collect||["runtime","resource","rejection"],e.__addHandler(),e}return i(r,p),t(r,[{key:"__addHandler",value:function(){var o=this;c(this.collect,"runtime")&&(b.onerror=function(o){for(var e=arguments.length,u=new Array(1<e?e-1:0),t=1;t<e;t++)u[t-1]=arguments[t];return function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];o&&"function"==typeof o?o.apply(e,r):e=o;for(var i=0;i<u.length;i++)u[i]&&u[i].apply(e,r)}}(function(e,t,r,n,i){o.__report(o.createExtractInfo({message:e,filename:t,lineNumber:r,columnNumber:n,error:i}),{source:"error"})},b.onerror&&b.onerror.bind(b))),c(this.collect,"resource")&&b.addEventListener("error",function(e){var t,r=e.srcElement;if((t=r)instanceof HTMLScriptElement||t instanceof HTMLLinkElement){var n=function(e){var t={};e instanceof HTMLScriptElement?t.url=e.src:e instanceof HTMLLinkElement&&(t.url=e.href);return t}(r);o.__report(o.createExtractInfo({message:"source error [".concat(n.url,"] ")}),{source:"error:source"})}},!0),c(this.collect,"rejection")&&b.addEventListener("unhandledrejection",function(e){o.__report(o.createExtractInfo(e.reason),{source:"unhandledrejection"})})}}]),r}();var E="File"in window,e=function(e){function c(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.submit,n=t.maxSize,i=void 0===n?5120:n,o=t.fileName,u=void 0===o?"log":o;return a(this,c),(e=f(this,l(c).call(this,{submit:r}))).fileName=u,e.maxSize=i,e.__currentSize=0,e.__fileText="",e}return i(c,v),t(c,[{key:"addReport",value:function(e,t){var r="";if(!e||!E)return this;if(t.from instanceof m)switch(t.level){case m.LEVEL_LOG:case m.LEVEL_INFO:r="[LOG] ";break;case m.LEVEL_WARN:r="[WARN] ";break;case m.LEVEL_ERROR:r="[ERROR] "}else r=t.from instanceof d?"[PERFORMANCE] ":t.from instanceof g?"[ERROR] ":"[UNKNOWN] ";return this.addText(r+JSON.stringify(e)+"\n"),this}},{key:"computeSize",value:function(e){for(var t=0,r=e.length,n=0;n<r;n++){var i=e.codePointAt(n);i<=127?t+=1:i<=2047?t+=2:i<=65535?t+=3:i<=1114111&&(t+=4)}return t}},{key:"addText",value:function(e){var t=this.computeSize(e);return this.__currentSize+t>this.maxSize&&this.__submit(),this.__fileText+=e,this.__currentSize+=this.computeSize(e),this}},{key:"clearText",value:function(){return this.__fileText="",this.__currentSize=0,this}},{key:"forceSubmit",value:function(){return this.__fileText&&o(this.submit)&&this.submit(this.__generateFile()),this}},{key:"__submit",value:function(){o(this.submit)&&this.submit(this.__generateFile()),this.clearText()}},{key:"__generateFile",value:function(e){var t="function"==typeof this.fileName?this.fileName():"string"==typeof this.fileName?this.fileName:"log.".concat(+new Date);return new File([e||this.__fileText],"".concat(t,".txt"),{type:"text/plain"})}},{key:"currentSize",get:function(){return this.__currentSize}},{key:"currentFileText",get:function(){return this.__fileText}}]),c}();function L(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.globalError,r=e.log,n=e.performance;this.globalErrorCollector=new g(t),this.logCollector=new m(r),this.performanceCollector=new d(n)}return L.version="0.0.2",L.Collector=p,L.GlobalErrorCollector=g,L.LogCollector=m,L.PerformanceCollector=d,L.Reporter=v,L.FileReporter=e,L});